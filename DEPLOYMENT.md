# AI Quiz Microservice - Deployment Guide

## Render.com Deployment (Free Tier)

This guide will help you deploy the AI Quiz Microservice to Render.com using their free tier.

### Prerequisites

1. A GitHub repository with this code
2. A Render.com account (free)
3. OpenAI API key or Google Gemini API key
4. Gmail account for email notifications (optional)

### Step-by-Step Deployment

#### 1. Prepare Your Repository

Ensure your repository has all the necessary files:
- âœ… `pyproject.toml` - Python dependencies
- âœ… `requirements.txt` - Alternative dependency format
- âœ… `Dockerfile` - Container configuration
- âœ… `render.yaml` - Render deployment configuration
- âœ… `start.sh` - Startup script
- âœ… `env.example` - Environment variables template

#### 2. Deploy to Render

**Option A: Using render.yaml (Recommended)**

1. Fork this repository to your GitHub account
2. Go to [Render Dashboard](https://dashboard.render.com)
3. Click "New" â†’ "Blueprint"
4. Connect your GitHub repository
5. Select your forked repository
6. Render will automatically detect `render.yaml` and create services

**Option B: Manual Setup**

1. **Create PostgreSQL Database:**
   - Go to Render Dashboard
   - Click "New" â†’ "PostgreSQL"
   - Name: `ai-quiz-postgres`
   - Select Free plan
   - Note the connection string

2. **Create Redis Instance:**
   - Click "New" â†’ "Redis"
   - Name: `ai-quiz-redis`
   - Select Free plan
   - Note the connection string

3. **Create Web Service:**
   - Click "New" â†’ "Web Service"
   - Connect your GitHub repository
   - Name: `ai-quiz-microservice`
   - Runtime: `Python 3`
   - Build Command: `pip install -e .`
   - Start Command: `./start.sh`
   - Select Free plan

#### 3. Configure Environment Variables

In your Render web service dashboard, add these environment variables:

**Required:**
```
ENV=production
JWT_SECRET=[auto-generated by Render]
DATABASE_URL=[auto-generated from PostgreSQL service]
REDIS_URL=[auto-generated from Redis service]
```

**AI Providers (at least one required):**
```
OPENAI_API_KEY=your_openai_key_here
GEMINI_API_KEY=your_gemini_key_here
```

**Email Notifications (optional):**
```
NOTIFICATION_ENABLED=true
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your_email@gmail.com
SMTP_PASSWORD=your_gmail_app_password
NOTIFICATION_FROM_EMAIL=noreply@yourdomain.com
```

**Performance & Security:**
```
CACHE_ENABLED=true
CACHE_TTL_SECONDS=3600
LOG_LEVEL=INFO
ALLOWED_ORIGINS=https://your-service-name.onrender.com
```

#### 4. Gmail App Password Setup (for Email Notifications)

1. Enable 2-Factor Authentication on your Gmail account
2. Go to Google Account settings
3. Security â†’ App passwords
4. Generate an app password for "Mail"
5. Use this password as `SMTP_PASSWORD`

#### 5. Deploy and Test

1. Click "Deploy" in Render dashboard
2. Wait for deployment to complete (5-10 minutes)
3. Your service will be available at: `https://your-service-name.onrender.com`
4. Test the API documentation at: `https://your-service-name.onrender.com/docs`

### Post-Deployment Testing

Use the provided `complete-test.ps1` script to test all features:

```powershell
# Update the base URL to your Render deployment
$baseUrl = "https://your-service-name.onrender.com"

# Run the complete test suite
.\complete-test.ps1
```

### Frontend Deployment

To deploy the `quiz-app.html` frontend:

1. **Option A: Render Static Site**
   - Create a new "Static Site" service
   - Point to your repository
   - Build Command: `echo "Static files ready"`
   - Publish Directory: `.`

2. **Option B: GitHub Pages**
   - Push `quiz-app.html` to a GitHub repository
   - Enable GitHub Pages
   - Update the API_BASE URL in the HTML file

3. **Option C: Netlify/Vercel**
   - Drag and drop `quiz-app.html` to their deployment interfaces
   - Update the API_BASE URL

### Monitoring and Logs

1. **Application Logs:**
   - Available in Render dashboard â†’ Service â†’ Logs
   - Structured JSON logging for easy parsing

2. **Health Checks:**
   - Health endpoint: `https://your-service-name.onrender.com/healthz`
   - Readiness endpoint: `https://your-service-name.onrender.com/readyz`

3. **Performance Monitoring:**
   - Redis caching reduces database load
   - Response times logged for optimization

### Free Tier Limitations

**Render Free Tier includes:**
- Web Service: 750 hours/month, sleeps after 15 min inactivity
- PostgreSQL: 1GB storage, 100 concurrent connections
- Redis: 25MB storage
- Custom domains require paid plan

**Optimization Tips:**
- Use Redis caching to reduce database queries
- Implement proper error handling for cold starts
- Monitor usage to stay within limits

### Troubleshooting

**Common Issues:**

1. **Service won't start:**
   - Check environment variables are set correctly
   - Verify database connection string
   - Check build logs for dependency issues

2. **Database connection errors:**
   - Ensure DATABASE_URL is correctly formatted
   - Check PostgreSQL service is running
   - Verify network connectivity

3. **Email notifications not working:**
   - Verify Gmail app password is correct
   - Check SMTP settings
   - Ensure 2FA is enabled on Gmail

4. **Caching issues:**
   - Verify Redis service is running
   - Check REDIS_URL format
   - Monitor Redis memory usage

### API Documentation

Once deployed, your API documentation will be available at:
- Swagger UI: `https://your-service-name.onrender.com/docs`
- ReDoc: `https://your-service-name.onrender.com/redoc`

### Security Considerations

1. **Environment Variables:**
   - Never commit API keys to repository
   - Use Render's environment variable system
   - Rotate secrets regularly

2. **CORS Configuration:**
   - Update ALLOWED_ORIGINS for production domains
   - Remove localhost origins in production

3. **Rate Limiting:**
   - Built-in rate limiting for hints and submissions
   - Consider additional rate limiting for production

### Scaling

**To upgrade from Free Tier:**

1. **Paid Plans Benefits:**
   - No sleep time
   - More resources
   - Custom domains
   - Priority support

2. **Database Scaling:**
   - Upgrade PostgreSQL plan for more storage
   - Consider read replicas for high traffic

3. **Performance Optimization:**
   - Enable Redis persistence
   - Implement connection pooling
   - Add CDN for static files

### Support

For deployment issues:
1. Check Render documentation: https://render.com/docs
2. Review application logs in Render dashboard
3. Test locally with Docker to isolate issues
4. Check this repository's issues for common problems

### Example Environment Configuration

Copy from `env.example` and customize:

```bash
# Production configuration
ENV=production
JWT_SECRET=your_32_character_secret_key_here
DATABASE_URL=postgresql+psycopg://user:pass@host:port/db
REDIS_URL=redis://host:port/0
OPENAI_API_KEY=sk-your-openai-key
NOTIFICATION_ENABLED=true
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
ALLOWED_ORIGINS=https://your-frontend.onrender.com
```

ðŸš€ **Your AI Quiz Microservice is now live and ready to serve intelligent quizzes with caching, leaderboards, and email notifications!**
